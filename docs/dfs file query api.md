# File Query API
This API is used to search for dfs file paths in the CDL HD DHI Model File Directory. This API operates within the context of a very rigid file directory structure. It was done in this way was the tradeoff of flexibility for simplicity and efficiency was well worth it.

## Table of Contents
* ### File Directory Structure
* ### `file_query_api()`

## File Directory Structure
The query api works given a path to a root directory where all DFS files are stored. This directory must conform to a very strict file structure, as this api has been designed with simplicity and efficiency as a priority over flexibility in its search. The directory structure for DFS files must follow the following structure:
```
|--|WaterForecastTT
|----|TT_HD
|------|Results
|--------|(yyyymmddhh) Date File
|----------|Datetime folder
|----------|Client Specific dfsu folder
|----------|HD_TT_01.dfsu
|----------|HD_TT_02.dfsu
|----------|HD_TT_03.dfsu
|----------|HD_TT_04.dfsu  
```
The `\Results` folder contains all datetime sub-folders. The file query api operates mainly in this level of the directory.

## `file_query_api(root_dir)`
This is the main api that is used to extract dfsu files generated by the model. It is initialized with the path string of the root directory of the file structure. This would be the directory path of the `WaterForecastTT` folder.

### `get_client_data(client_name, date=None)`
This is the main method of the api that searches for dfsu files in the CDL directory based on a specific client. The query can be constructed without a date, in which case it returns a list of path strings for all dfsu files associated with the client or a date can be specified, in which case the list returned contains only path strings of client dfsu files within the specified date range.

The method makes uses of conditionals and the `os.walk` method to crawl through the directory structure and selectively append file paths that meet the criteria set by the input parameters to a main list that is returned.

#### `date=None`
The date specified by the `date` parameter must be in the format used in the file directory: a string in the form `"yyyymmddhh"`.

**Note:** The query selects folders that match the specified date via the python logic:
```python
if date in dirname:
  # Perform further action
```
Due to this use of `if in` the date format can be lengthened or shortened to change the
specificity of the search:

For example setting the date parameter to `"2020"` would return all client dfsu paths for the whole year of 2020. Setting the date parameter to `"202010"` would return all client dfsu paths for October 2020 etc etc.

### `get_client_dates(self, client_name)`
This method makes use of the `os.walk()` method to iterate through the entire set of Datetime folders (yyyymmddhh) and builds a list of date strings (of the same format) corresponding to the Datetime folders that contain client specific dfsu files.

This is done by conditional statements that slice filepath strings in a brute-force manner to build said Datetime strings if the filepath of a dfsu file contains both the client name as well as a datetime string. Example of how this works:

```python
# Initializing api with root directory:
test = file_query_api("C:\\Users\\teelu\\OneDrive\\Desktop\\test_data\\WaterForecastTT")

# Extracting list of date files that contain dfsu files for the client BP_TT:
test_date_lst = test.get_client_dates('BPTT_Cipre')

# -------Output-----------
test_date_lst = ['2020041112', '2020041512', '2020041712']
```  
Note that these are not the Datetime folders that contain a sub-directory with the client name, but a list of Datetime folders that contain a sub-directory with the client name THAT ALSO contains dfsu files. For example in:
```
|- Datetime Folder
|--- BP_TT Folder
|--- Timeseries
```
The Datetime folder would not be added to the list as even though it contains a client name sub-folder, that sub-folder does not contain any actual dfsu files. The following Datetime folder would be added to the list however as it does contain a dfsu file:
```
|- Datetime Folder
|--- BB_TT Folder
|----- BP_TT_01.dfsu
|----- BP_TT_02.dfsu
|--- Timeseries
```
